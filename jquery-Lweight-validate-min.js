/* =========================================================
 * jquery-Lightweight-validation.js 
 * Original Idea: (Copyright 2013 Stefan Petre)
 * Updated by 大猫 
 * version 1.0.3 beta
 * =========================================================
 * http://vikenlove.github.io/jquery-Lweight-validate
 * http://www.oschina.net/p/jquery-lweight-validate 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================= */
(function(e){e.fn.myValidate=function(a){var c=this;c.find("button[btn-type=true]").click(function(){k(c)||a!=void 0&&a()});e(window).keydown(function(b){switch(b.keyCode){case 13:k(c)||a!=void 0&&a()}});n(c)};var l=[{name:"required",validate:function(a){return e.trim(a)==""},defaultMsg:"\u8bf7\u8f93\u5165\u5185\u5bb9\u3002"},{name:"number",validate:function(a){return!/^[0-9]\d*$/.test(a)},defaultMsg:"\u8bf7\u8f93\u5165\u6570\u5b57\u3002"},{name:"mail",validate:function(a){return!/^[a-zA-Z0-9]{1}([\._a-zA-Z0-9-]+)(\.[_a-zA-Z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+){1,3}$/.test(a)},defaultMsg:"\u8bf7\u8f93\u5165\u90ae\u7bb1\u5730\u5740\u3002"},{name:"char",validate:function(a){return!/^[a-z\_\-A-Z]*$/.test(a)},defaultMsg:"\u8bf7\u8f93\u5165\u82f1\u6587\u5b57\u7b26\u3002"},{name:"chinese",validate:function(a){return!/^[\u4e00-\u9fff]$/.test(a)},defaultMsg:"\u8bf7\u8f93\u5165\u6c49\u5b57\u3002"},{name:"mobile",validate:function(a){return!/^(13|15|18)[0-9]{9}$/.test(a)},defaultMsg:"\u60c5\u8f93\u5165\u6b63\u786e\u624b\u673a\u53f7\u7801\u3002"},{name:"passWord",validate:function(a){var c;a=e.trim(a);if(a.length>=6)if(/[a-zA-Z]+/.test(a)&&/[0-9]+/.test(a)&&/\W+\D+/.test(a))c=1;else{if(/[a-zA-Z]+/.test(a)||/[0-9]+/.test(a)||/\W+\D+/.test(a))c=/[a-zA-Z]+/.test(a)&&/[0-9]+/.test(a)?2:/\[a-zA-Z]+/.test(a)&&/\W+\D+/.test(a)?2:/[0-9]+/.test(a)&&/\W+\D+/.test(a)?2:3}else c=-1;return c},defaultMsg:"\u5bc6\u7801\u957f\u5ea6\u5fc5\u987b\u57286~16\u4e4b\u95f4\u3002"},{name:"confirmPwd",validate:function(){var a=e("input[type='password']"),c="",b="";a.size()==3?(c=e.trim(a.eq(1).val()),b=e.trim(a.eq(2).val())):(c=e.trim(a.eq(0).val()),b=e.trim(a.eq(1).val()));return b.length>0?c==b?false:true:true},defaultMsg:"\u4e24\u6b21\u5bc6\u7801\u4e0d\u4e00\u81f4"},{name:"dateYmd",validate:function(a){a=a.match(/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2})$/);if(a==null)a=true;else var c=new Date(a[1],a[3]-1,a[4]),a=!(c.getFullYear()==a[1]&&c.getMonth()+1==a[3]&&c.getDate()==a[4]);return a},defaultMsg:"\u8bf7\u8f93\u5165YYYY--MM--DD\u683c\u5f0f"},{name:"idCard",validate:function(a){return o(a)},defaultMsg:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u8eab\u4efd\u8bc1\u53f7\u7801"}],p={11:"\u5317\u4eac",12:"\u5929\u6d25",13:"\u6cb3\u5317",14:"\u5c71\u897f",15:"\u5185\u8499\u53e4",21:"\u8fbd\u5b81",22:"\u5409\u6797",23:"\u9ed1\u9f99\u6c5f",31:"\u4e0a\u6d77",32:"\u6c5f\u82cf",33:"\u6d59\u6c5f",34:"\u5b89\u5fbd",35:"\u798f\u5efa",36:"\u6c5f\u897f",37:"\u5c71\u4e1c",41:"\u6cb3\u5357",42:"\u6e56\u5317",43:"\u6e56\u5357",44:"\u5e7f\u4e1c",45:"\u5e7f\u897f",46:"\u6d77\u5357",50:"\u91cd\u5e86",51:"\u56db\u5ddd",52:"\u8d35\u5dde",53:"\u4e91\u5357",54:"\u897f\u85cf",61:"\u9655\u897f",62:"\u7518\u8083",63:"\u9752\u6d77",64:"\u5b81\u590f",65:"\u65b0\u7586",71:"\u53f0\u6e7e",81:"\u9999\u6e2f",82:"\u6fb3\u95e8",91:"\u56fd\u5916"},o=function(a){var c=0,b;if(!/^\d{17}(\d|x)$/i.test(a))return true;a=a.replace(/x$/i,"a");if(p[parseInt(a.substr(0,2))]==null)return true;b=a.substr(6,4)+"-"+Number(a.substr(10,2))+"-"+Number(a.substr(12,2));var d=new Date(b.replace(/-/g,"/"));if(b!=d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate())return true;for(b=17;b>=0;b--)c+=Math.pow(2,b)%11*parseInt(a.charAt(17-b),11);return c%11!=1?true:false},n=function(a){e(a).find("input,textarea,select").each(function(){var a=e(this),b=a.attr("check-type")==void 0?null:a.attr("check-type").split(" ");b!==null&&b.length>0&&(a.focus(function(){var b=a.parent().children(".help-inline");b.hasClass("help-inline")&&b.remove()}),a.blur(function(){m(a,b)}))})},k=function(a){var c=false;e(a).find("input,textarea,select").each(function(){var a=e(this),d=a.attr("check-type")==void 0?null:a.attr("check-type").split(" ");d!==null&&d.length>0&&(m(a,d)||(c=true))});return c},m=function(a,c){for(var b=e(a),d=false,h="",i=0,j=b.val().length,f=0;f<l.length;f++){var g=l[f];if(c==g.name)if(g.name=="passWord"){i=g.validate(b.val());i==-1&&(d=true,h=b.attr("required-message")==void 0?g.defaultMsg:b.attr("required-message"));break}else if(g.validate(b.val())){d=true;h=b.attr("required-message")==void 0?g.defaultMsg:b.attr("required-message");break}}d||(f=b.attr("min-max")==void 0?null:b.attr("min-max").split(" "),g=b.attr("data-callback")==void 0?null:b.attr("data-callback").split(" "),f!==null&&f.length>0?(f=b.attr("min-max").split("-")[0],g=b.attr("min-max").split("-")[1],j<Number(f)?(d=true,h=b.attr("min-message")==void 0?"\u6587\u672c\u957f\u5ea6\u4e0d\u80fd\u5c0f\u4e8e"+f+"\u4e2a\u5b57\u7b26":b.attr("min-message")):g!=void 0&&j>=Number(g)&&(d=true,h=b.attr("max-message")==void 0?"\u6587\u672c\u957f\u5ea6\u4e0d\u80fd\u5927\u4e8e"+g+"\u4e2a\u5b57\u7b26":b.attr("max-message"))):g!==null&&g.length>0&&(d=b.attr("data-callback"),(d=eval(d))&&(h=b.attr("call-message")==void 0?"\u6821\u9a8c\u65e0\u6cd5\u901a\u8fc7\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165":b.attr("call-message"))));j=b.parent();f=j.children(".help-inline");d?(f.hasClass("help-inline")?(i=f.text(),j.data("help-inline",i)):j.append('<span class="help-inline error">'+h+"</span>"),b.removeClass().addClass("error")):(i>0?(h=q(i),i=r(i),f.hasClass("help-inline")?j.data("help-inline",h):j.append('<span class="help-inline '+i+'">'+h+"</span>")):f.remove(),b.removeClass().addClass("right"));return!d},r=function(a){var c="";switch(a){case 1:c="passWord3";break;case 2:c="passWord2";break;case 3:c="passWord1"}return c},q=function(a){var c="";switch(a){case 1:c="\u5f3a";break;case 2:c="\u4e2d";break;case 3:c="\u5f31"}return c}})(jQuery);
