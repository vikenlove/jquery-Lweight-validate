/* =========================================================
 * jquery-Lightweight-validation.js 
 * Original Idea: (Copyright 2013 Stefan Petre)
 * Updated by 大猫 
 * version 1.0.3 beta
 * =========================================================
 * http://vikenlove.github.io/jquery-Lweight-validate
 * http://www.oschina.net/p/jquery-lweight-validate 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================= */
(function($){$.fn.myValidate=function(callbacksuccess){var $this=this;$this.find("button[btn-type=true]").click(function(){validateClick($this)});$(window).keydown(function(event){switch(event.keyCode){case 13:validateClick($this);break}});validateBlur($this)};var validateClick=function(obj){if(!validateForm(obj))callbacksuccess()};var defaults={validRules:[{name:"required",validate:function(value){return $.trim(value)==""},defaultMsg:"\u8bf7\u8f93\u5165\u5185\u5bb9\u3002"},{name:"number",validate:function(value){return!/^[0-9]\d*$/.test(value)},defaultMsg:"\u8bf7\u8f93\u5165\u6570\u5b57\u3002"},{name:"mail",validate:function(value){return!/^[a-zA-Z0-9]{1}([\._a-zA-Z0-9-]+)(\.[_a-zA-Z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+){1,3}$/.test(value)},defaultMsg:"\u8bf7\u8f93\u5165\u90ae\u7bb1\u5730\u5740\u3002"},{name:"char",validate:function(value){return!/^[a-z\_\-A-Z]*$/.test(value)},defaultMsg:"\u8bf7\u8f93\u5165\u82f1\u6587\u5b57\u7b26\u3002"},{name:"chinese",validate:function(value){return!/^[\u4e00-\u9fff]$/.test(value)},defaultMsg:"\u8bf7\u8f93\u5165\u6c49\u5b57\u3002"},{name:"mobile",validate:function(value){return!/^(13|15|18)[0-9]{9}$/.test(value)},defaultMsg:"\u60c5\u8f93\u5165\u6b63\u786e\u624b\u673a\u53f7\u7801\u3002"},{name:"passWord",validate:function(value){return checkPwd($.trim(value))},defaultMsg:"\u5bc6\u7801\u957f\u5ea6\u5fc5\u987b\u57286~16\u4e4b\u95f4\u3002"},{name:"confirmPwd",validate:function(value){return confirmPwd(value)},defaultMsg:"\u4e24\u6b21\u5bc6\u7801\u4e0d\u4e00\u81f4"},{name:"dateYmd",validate:function(value){return checkDate(value)},defaultMsg:"\u8bf7\u8f93\u5165YYYY--MM--DD\u683c\u5f0f"},{name:"idCard",validate:function(value){return checkIdCard(value)},defaultMsg:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u8eab\u4efd\u8bc1\u53f7\u7801"}]};var city={11:"\u5317\u4eac",12:"\u5929\u6d25",13:"\u6cb3\u5317",14:"\u5c71\u897f",15:"\u5185\u8499\u53e4",21:"\u8fbd\u5b81",22:"\u5409\u6797",23:"\u9ed1\u9f99\u6c5f",31:"\u4e0a\u6d77",32:"\u6c5f\u82cf",33:"\u6d59\u6c5f",34:"\u5b89\u5fbd",35:"\u798f\u5efa",36:"\u6c5f\u897f",37:"\u5c71\u4e1c",41:"\u6cb3\u5357",42:"\u6e56\u5317",43:"\u6e56\u5357",44:"\u5e7f\u4e1c",45:"\u5e7f\u897f",46:"\u6d77\u5357",50:"\u91cd\u5e86",51:"\u56db\u5ddd",52:"\u8d35\u5dde",53:"\u4e91\u5357",54:"\u897f\u85cf",61:"\u9655\u897f",62:"\u7518\u8083",63:"\u9752\u6d77",64:"\u5b81\u590f",65:"\u65b0\u7586",71:"\u53f0\u6e7e",81:"\u9999\u6e2f",82:"\u6fb3\u95e8",91:"\u56fd\u5916"};var checkIdCard=function(value){var iSum=0,info="",birthday;if(!/^\d{17}(\d|x)$/i.test(value))return true;value=value.replace(/x$/i,"a");if(city[parseInt(value.substr(0,2))]==null)return true;birthday=value.substr(6,4)+"-"+Number(value.substr(10,2))+"-"+Number(value.substr(12,2));var d=new Date(birthday.replace(/-/g,"/"));if(birthday!=d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate())return true;for(var i=17;i>=0;i--)iSum+=Math.pow(2,i)%11*parseInt(value.charAt(17-i),11);if(iSum%11!=1)return true;return false};var checkDate=function(value){var r=value.match(/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2})$/);if(r==null)return true;var d=new Date(r[1],r[3]-1,r[4]);return!(d.getFullYear()==r[1]&&d.getMonth()+1==r[3]&&d.getDate()==r[4])};var confirmPwd=function(value){var inputObj=$("input[type='password']");var pwd1=$.trim(inputObj.eq(0).val());var pwd2=$.trim(inputObj.eq(1).val());return pwd2.length>0?pwd1==pwd2?false:true:true};var checkPwd=function(value){if(value.length>=6)if(/[a-zA-Z]+/.test(value)&&/[0-9]+/.test(value)&&/\W+\D+/.test(value))return 1;else{if(/[a-zA-Z]+/.test(value)||/[0-9]+/.test(value)||/\W+\D+/.test(value))if(/[a-zA-Z]+/.test(value)&&/[0-9]+/.test(value))return 2;else if(/\[a-zA-Z]+/.test(value)&&/\W+\D+/.test(value))return 2;else if(/[0-9]+/.test(value)&&/\W+\D+/.test(value))return 2;else return 3}else return-1};var validateBlur=function(obj){$(obj).find("input,textarea,select").each(function(){var el=$(this),valid=el.attr("check-type")==undefined?null:el.attr("check-type").split(" ");if(valid!==null&&valid.length>0){el.focus(function(){var curTextDiv=el.parent(),curErrorEl=curTextDiv.children(".help-inline");if(curErrorEl.hasClass("help-inline"))curErrorEl.remove()});el.blur(function(){validateField(el,valid)})}})};var validateForm=function(obj){var validationError=false;$(obj).find("input,textarea,select").each(function(){var el=$(this),valid=el.attr("check-type")==undefined?null:el.attr("check-type").split(" ");if(valid!==null&&valid.length>0)if(!validateField(el,valid))validationError=true});return validationError};var validateField=function(field,valid){var el=$(field),error=false,errorMsg="",pwdStatus=0,elLength=el.val().length;var rules=defaults.validRules;for(var i=0;i<rules.length;i++){var rule=rules[i];if(valid==rule.name)if(rule.name=="passWord"){pwdStatus=rule.validate(el.val());if(pwdStatus==-1){error=true;errorMsg=el.attr("required-message")==undefined?rule.defaultMsg:el.attr("required-message")}break}else if(rule.validate(el.val())){error=true;errorMsg=el.attr("required-message")==undefined?rule.defaultMsg:el.attr("required-message");break}}if(!error){var minMax=el.attr("min-max")==undefined?null:el.attr("min-max").split(" ");var _callBack=el.attr("data-callback")==undefined?null:el.attr("data-callback").split(" ");if(minMax!==null&&minMax.length>0){var min=el.attr("min-max").split("-")[0],max=el.attr("min-max").split("-")[1];if(elLength<Number(min)){error=true;errorMsg=el.attr("min-message")==undefined?"\u6587\u672c\u957f\u5ea6\u4e0d\u80fd\u5c0f\u4e8e"+min+"\u4e2a\u5b57\u7b26":el.attr("min-message")}else if(max!=undefined)if(elLength>=Number(max)){error=true;errorMsg=el.attr("max-message")==undefined?"\u6587\u672c\u957f\u5ea6\u4e0d\u80fd\u5927\u4e8e"+max+"\u4e2a\u5b57\u7b26":el.attr("max-message")}}else if(_callBack!==null&&_callBack.length>0){var _ajaxCallBack=el.attr("data-callback");error=eval(_ajaxCallBack);if(error)errorMsg=el.attr("call-message")==undefined?"\u6821\u9a8c\u65e0\u6cd5\u901a\u8fc7\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165":el.attr("call-message")}}var curTextDiv=el.parent(),curErrorEl=curTextDiv.children(".help-inline");if(error){if(curErrorEl.hasClass("help-inline")){var overHelp=curErrorEl.text();curTextDiv.data("help-inline",overHelp)}else curTextDiv.append('<span class="help-inline error">'+errorMsg+"</span>");el.removeClass().addClass("error")}else if(pwdStatus>0){var pwdStrong=passWordStatus(pwdStatus);var classpic=classStatus(pwdStatus);if(curErrorEl.hasClass("help-inline"))curTextDiv.data("help-inline",pwdStrong);else curTextDiv.append('<span class="help-inline '+classpic+'">'+pwdStrong+"</span>");el.removeClass().addClass("right")}else{curErrorEl.remove();el.removeClass().addClass("right")}return!error};var classStatus=function(i){var status="";switch(i){case 1:status="passWord3";break;case 2:status="passWord2";break;case 3:status="passWord1";break}return status};var passWordStatus=function(i){var status="";switch(i){case 1:status="\u5f3a";break;case 2:status="\u4e2d";break;case 3:status="\u5f31";break}return status}})(jQuery);
