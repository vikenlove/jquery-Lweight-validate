/* =========================================================
 * jquery-Lightweight-validation.js 
 * Original Idea: (Copyright 2013 Viken)
 * Updated by 大猫 
 * version 1.1.6  
 * =========================================================
 * http://vikenlove.github.io/jquery-Lweight-validate
 * http://www.oschina.net/p/jquery-lweight-validate 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *  
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================= */
(function($){$.fn.myValidate=function(options){var globalOptions=$.extend({},$.fn.defaults,options);var $this=this;$this.find("[btn-type=true]").on("mousedown",function(){validateClick($this,globalOptions,$(this).attr("btn-val"))});if(globalOptions.formKey){$(document).keyup(function(event){switch(event.keyCode){case 13:validateClick($this,globalOptions);break}})}validateBlur($this,globalOptions)};var validateClick=function(obj,globalOptions,btnVal){globalOptions.eventStatus=true;if(!validateForm(obj,globalOptions)){if(globalOptions.formCall!=undefined){if(btnVal!=undefined){globalOptions.formCall(btnVal)}else{globalOptions.formCall()}}}};$.fn.defaults={validRules:[{name:"required",validate:function(value){return $.trim(value)==""||$.trim(value).length==0},defaultMsg:"\u8bf7\u8f93\u5165\u5185\u5bb9,\u5b57\u7b26\u6570\u4e0d\u80fd\u8d85\u8fc720\u3002"},{name:"unRequired",validate:function(value){return false},defaultMsg:"\u8bf7\u8f93\u5165\u5185\u5bb9\u3002"},{name:"number",validate:function(value){return !/^[0-9]+(\.)?[0-9]*$/.test($.trim(value))},defaultMsg:"\u8bf7\u8f93\u5165\u6570\u5b57\u3002"},{name:"mail",validate:function(value){return !/^[a-zA-Z0-9]{1}([\._a-zA-Z0-9-]+)(\.[_a-zA-Z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+){1,3}$/.test($.trim(value))},defaultMsg:"\u8bf7\u8f93\u5165\u90ae\u7bb1\u5730\u5740\u3002"},{name:"char",validate:function(value){return !/^[a-z\_\-A-Z]*$/.test($.trim(value))},defaultMsg:"\u8bf7\u8f93\u5165\u82f1\u6587\u5b57\u7b26\u3002"},{name:"chinese",validate:function(value){return !/^[\u4e00-\u9fff]+$/.test($.trim(value))},defaultMsg:"\u8bf7\u8f93\u5165\u6c49\u5b57\u3002"},{name:"mobile",validate:function(value){return !/^(13|15|18)[0-9]{9}$/.test($.trim(value))},defaultMsg:"\u8bf7\u8f93\u5165\u6b63\u786e\u624b\u673a\u53f7\u7801\u3002"},{name:"tell",validate:function(value){return checkTel($.trim(value))},defaultMsg:"\u8bf7\u8f93\u5165\u6b63\u786e\u7535\u8bdd\u53f7\u7801\u683c\u5f0f:\u533a\u53f7-\u53f7\u7801\u6216\u624b\u673a\u53f7\u3002"},{name:"passWord",validate:function(value){return checkPwd($.trim(value))},defaultMsg:"\u5bc6\u7801\u957f\u5ea6\u5fc5\u987b\u57286~20\u4e4b\u95f4\u3002"},{name:"confirmPwd",validate:function(value,objel){return confirmPwd($.trim(value),objel)},defaultMsg:"\u4e24\u6b21\u5bc6\u7801\u4e0d\u4e00\u81f4"},{name:"dateYmd",validate:function(value){return checkDate($.trim(value))},defaultMsg:"\u8bf7\u8f93\u5165YYYY--MM--DD\u683c\u5f0f"},{name:"idCard",validate:function(value){return checkIdCard($.trim(value))},defaultMsg:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u8eab\u4efd\u8bc1\u53f7\u7801"},{name:"dateCompare",validate:function(value){return dateCompare()},defaultMsg:"\u8d77\u59cb\u65e5\u671f\u4e0d\u80fd\u5927\u4e8e\u7ed3\u675f\u65e5\u671f"},{name:"checkLength",validate:function(value){return $.trim(value).length>20},defaultMsg:"\u5b57\u7b26\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc720\u3002"},{name:"url",validate:function(value){return !/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})).?)(?::\d{2,5})?(?:[\/?#]\S*)?$/i.test($.trim(value))},defaultMsg:"\u8bf7\u8f93\u6b63\u786e\u7684\u7f51\u5740\u3002"},{name:"username",validate:function(value){return !/^[a-zA-Z]{1}([a-zA-Z0-9]|[._]){4,19}$/.test($.trim(value))},defaultMsg:"\u8bf7\u8f93\u51655-20\u4e2a\u4ee5\u5b57\u6bcd\u5f00\u5934\u3001\u53ef\u5e26\u6570\u5b57\u3001\u201c_\u201d\u3001\u201c.\u201d\u7684\u5b57\u4e32"}],city:[{11:"\u5317\u4eac",12:"\u5929\u6d25",13:"\u6cb3\u5317",14:"\u5c71\u897f",15:"\u5185\u8499\u53e4",21:"\u8fbd\u5b81",22:"\u5409\u6797",23:"\u9ed1\u9f99\u6c5f",31:"\u4e0a\u6d77",32:"\u6c5f\u82cf",33:"\u6d59\u6c5f",34:"\u5b89\u5fbd",35:"\u798f\u5efa",36:"\u6c5f\u897f",37:"\u5c71\u4e1c",41:"\u6cb3\u5357",42:"\u6e56\u5317",43:"\u6e56\u5357",44:"\u5e7f\u4e1c",45:"\u5e7f\u897f",46:"\u6d77\u5357",50:"\u91cd\u5e86",51:"\u56db\u5ddd",52:"\u8d35\u5dde",53:"\u4e91\u5357",54:"\u897f\u85cf",61:"\u9655\u897f",62:"\u7518\u8083",63:"\u9752\u6d77",64:"\u5b81\u590f",65:"\u65b0\u7586",71:"\u53f0\u6e7e",81:"\u9999\u6e2f",82:"\u6fb3\u95e8",91:"\u56fd\u5916"}],errorCustom:{customFlag:false,regionText:false}};var validateBlur=function(obj,globalOptions){$(obj).find("input,textarea,select").each(function(){var el=$(this);var valid=el.attr("check-type")==undefined?null:el.attr("check-type").split(" ");if(valid!==null&&valid.length>0){el.focus(function(){globalOptions.eventStatus=false;var curTextDiv=el.parent(),curErrorEl=curTextDiv.children(".help-inline");if(globalOptions.errorCustom.customFlag){if(globalOptions.errorCustom.regionText){var checkType=el.attr("check-type");if(checkType=="passWord"||checkType=="confirmPwd"){el.attr("type","password")}el.val(el.attr("srcValue")).css("color","")}else{el.siblings("."+globalOptions.errorStyle.errorRegion).text("").removeClass(globalOptions.errorStyle.errorClass)}}else{if(curErrorEl.hasClass("help-inline")){curErrorEl.remove()}else{if(curTextDiv.parent().children(".help-inline").hasClass("help-inline")){curTextDiv.parent().children(".help-inline").remove()}}}});el.blur(function(){if(el.attr("check-type")=="dateYmd"){setTimeout(function(){validateField(el,valid,globalOptions)},500)}else{if(!globalOptions.eventStatus){validateField(el,valid,globalOptions)}}})}})};var validateForm=function(obj,globalOptions){var validationError=false;$(obj).find("input:visible,textarea:visible,select:visible").each(function(){var el=$(this);var valid=el.attr("check-type")==undefined?null:el.attr("check-type").split(" ");if(valid!==null&&valid.length>0){if(!validateField(el,valid,globalOptions)){validationError=true}}if(globalOptions.isAlert){if(validationError){return false}}});return validationError};var validateField=function(field,valid,globalOptions){var el=$(field),_elVal=$.trim(el.val());var error=false,isNonFlag=false,errorMsg="",pwdStatus=0,elLength=_elVal!==null||_elVal!=""?_elVal.length:0;var isNon=el.attr("non-required")==undefined||el.attr("non-required")=="false"?false:true;var rules=globalOptions.validRules;for(var i=0,j=rules.length;i<j;i++){var rule=rules[i];if(valid==rule.name){var ruleVal=rule.validate(_elVal,el);if(isNon){if(elLength>0){if(ruleVal==true||ruleVal==-1){error=true;errorMsg=el.attr("required-message")==undefined?rule.defaultMsg:el.attr("required-message");break}else{isNonFlag=true}}}else{if(ruleVal==true||ruleVal==-1){error=true;errorMsg=el.attr("required-message")==undefined?rule.defaultMsg:el.attr("required-message");break}}}}if(!error){if(elLength>0){var minMax=el.attr("min-max")==undefined?null:el.attr("min-max").split(" ");var _callBack=el.attr("data-callback")==undefined?null:el.attr("data-callback").split(" ");if(minMax!==null&&minMax.length>0){var min=el.attr("min-max").split("-")[0],max=el.attr("min-max").split("-")[1];if(elLength<Number(min)){error=true;errorMsg=el.attr("min-message")==undefined?"\u6587\u672c\u957f\u5ea6\u4e0d\u80fd\u5c0f\u4e8e"+min+"\u4e2a\u5b57\u7b26":el.attr("min-message")}else{if(max!=undefined){if(elLength>Number(max)){error=true;errorMsg=el.attr("max-message")==undefined?"\u6587\u672c\u957f\u5ea6\u4e0d\u80fd\u5927\u4e8e"+max+"\u4e2a\u5b57\u7b26":el.attr("max-message")}}else{isNonFlag=true}}}if(!error){if(_callBack!==null&&_callBack.length>0){var _ajaxCallBack=el.attr("data-callback");error=eval(_ajaxCallBack);if(error){errorMsg=el.attr("call-message")==undefined?"\u6821\u9a8c\u65e0\u6cd5\u901a\u8fc7\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165":el.attr("call-message")}}}}}var curTextDiv=el.parent(),curErrorEl=curTextDiv.children(".help-inline"),uniformDiv=curTextDiv.attr("id");if(error){if(globalOptions.isAlert){if(globalOptions.alterCall!=undefined){globalOptions.alterCall(errorMsg)}else{alert(errorMsg)}}else{if(uniformDiv!=undefined&&uniformDiv.indexOf("uniform-")>-1){if(curTextDiv.parent().children(".help-inline").hasClass("help-inline")){curTextDiv.parent().data("help-inline",errorMsg)}else{if(globalOptions.errorCustom.customFlag){el.siblings("."+globalOptions.errorStyle.errorRegion).append(errorMsg)}else{curTextDiv.parent().append('<span class="help-inline error">'+errorMsg+"</span>")}}}else{if(globalOptions.errorCustom.customFlag){if(globalOptions.errorCustom.regionText){if(el.attr("type")=="password"){el.attr("type","text")}var textValue=el.val();el.val(errorMsg).css("color","#cccccc").attr("srcValue",textValue)}else{el.siblings("."+globalOptions.errorStyle.errorRegion).text(errorMsg)}}else{if(curErrorEl.hasClass("help-inline")){curTextDiv.data("help-inline",errorMsg)}else{curTextDiv.append('<span class="help-inline error">'+errorMsg+"</span>")}}}removeElStyleClass(el,globalOptions,1)}}else{if(ruleVal>0){var pwdStrong=passWordStatus(ruleVal);var classpic=classStatus(ruleVal);if(globalOptions.errorCustom.customFlag){if(globalOptions.errorCustom.regionText){var textValue=el.val();if(error){el.val(errorMsg).css("color","#cccccc").attr("srcValue",textValue)}else{el.attr("srcValue",textValue)}}else{el.siblings("."+globalOptions.errorStyle.errorRegion).text(pwdStrong)}}else{if(curErrorEl.hasClass("help-inline")){curTextDiv.data("help-inline",pwdStrong)}else{curTextDiv.append('<span class="help-inline '+classpic+'">'+pwdStrong+"</span>")}}removeElStyleClass(el,globalOptions,2)}else{if(!globalOptions.isAlert){curErrorEl.remove();removeElStyleClass(el,globalOptions,2);if(globalOptions.errorCustom.regionText){el.attr("srcValue",el.val())}}}}return !error};var removeElStyleClass=function(objel,globalOptions,reomveType){if(globalOptions.errorStyle!=undefined){var styleOption=globalOptions.errorStyle,$objelProperty;if(globalOptions.errorCustom.regionText){$objelProperty=objel.parents("."+styleOption.errorRegion)}else{$objelProperty=objel.siblings("."+styleOption.errorRegion)}if(reomveType==1){$objelProperty.removeClass(styleOption.rightClass).addClass(styleOption.errorClass)}else{$objelProperty.removeClass(styleOption.errorClass).addClass(styleOption.rightClass)}}else{if(reomveType==1){objel.removeClass("right").addClass("error")}else{objel.removeClass("error").addClass("right")}}};var trimReplaceHtml=function(value){return $.trim(value.replace(/\r\n/g,""))};var checkIdCard=function(value){var iSum=0,birthday;if(!/^\d{17}(\d|x)$/i.test(value)){return true}value=value.replace(/x$/i,"a");if($(this).defaults.city[0][parseInt(value.substr(0,2))]==null){return true}birthday=value.substr(6,4)+"-"+Number(value.substr(10,2))+"-"+Number(value.substr(12,2));var d=new Date(birthday.replace(/-/g,"/"));if(birthday!=d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()){return true}for(var i=17;i>=0;i--){iSum+=Math.pow(2,i)%11*parseInt(value.charAt(17-i),11)}if(iSum%11!=1){return true}return false};var dateCompare=function(){var $this=$("input[check-type='dateCompare']"),flag=false;if($this.eq(0).val().length>0&&$this.eq(1).val().length>0){if($this.eq(0).val()!=$this.eq(1).val()){var startDate=Number($this.eq(0).val().replace(/-/g,"")),endDate=Number($this.eq(1).val().replace(/-/g,""));flag=startDate<endDate?false:true}}return flag};var checkDate=function(value){var r=value.match(/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2})$/);if(r==null){return true}var d=new Date(r[1],r[3]-1,r[4]);return !(d.getFullYear()==r[1]&&d.getMonth()+1==r[3]&&d.getDate()==r[4])};var confirmPwd=function(value,objel){var inputObj=$(objel).parents("form").find("input[type='password']");var pwd1="",pwd2="";if(inputObj.size()==3){pwd1=$.trim(inputObj.eq(1).val());pwd2=$.trim(inputObj.eq(2).val())}else{pwd1=$.trim(inputObj.eq(0).val());pwd2=$.trim(inputObj.eq(1).val())}return pwd2.length>=0?pwd1==pwd2?false:true:true};var checkPwd=function(value){if(value.length>=6&&value.length<=20){if(/[a-zA-Z_]+/.test(value)&&/[0-9]+/.test(value)&&/\W+/.test(value)){return 4}else{if(/[a-zA-Z_]+/.test(value)||/[0-9]+/.test(value)||/\W+/.test(value)){if(/[a-zA-Z_]+/.test(value)&&/[0-9]+/.test(value)){return 2}else{if(/[a-zA-Z_]+/.test(value)&&/\W+/.test(value)){return 2}else{if(/[0-9]+/.test(value)&&/\W+/.test(value)){return 2}else{if(/[a-zA-Z_]+/.test(value)&&/[0-9]+/.test(value)&&/\W+/.test(value)){return 1}else{return 3}}}}}}}else{return true}};var checkTel=function(value){var r=value.match(/^(17[0-9]|13[0-9]|15[0|1|3|6|7|8|9]|18[8|9])\d{8}$/);var r1=value.match(/^(\d{3,4}|\d{3,4}-|\s)?\d{8}$/);if(r==null&&r1==null){return true}};var classStatus=function(i){var status="";switch(i){case 4:status="passWord3";break;case 2:status="passWord2";break;case 3:status="passWord1";break}return status};var passWordStatus=function(i){var status="";switch(i){case 4:status="\u5f3a";break;case 2:status="\u4e2d";break;case 3:status="\u5f31";break}return status}})(jQuery);


