(function($){$.fn.myValidate=function(a){var b=this;b.find("button[btn-type=true]").click(function(){validateForm(b)||a()}),validateBlur(b)};var defaults={validRules:[{name:"required",validate:function(a){return""==$.trim(a)},defaultMsg:"\u8bf7\u8f93\u5165\u5185\u5bb9\u3002"},{name:"number",validate:function(a){return!/^[0-9]\d*$/.test(a)},defaultMsg:"\u8bf7\u8f93\u5165\u6570\u5b57\u3002"},{name:"mail",validate:function(a){return!/^[a-zA-Z0-9]{1}([\._a-zA-Z0-9-]+)(\.[_a-zA-Z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+){1,3}$/.test(a)},defaultMsg:"\u8bf7\u8f93\u5165\u90ae\u7bb1\u5730\u5740\u3002"},{name:"char",validate:function(a){return!/^[a-z\_\-A-Z]*$/.test(a)},defaultMsg:"\u8bf7\u8f93\u5165\u82f1\u6587\u5b57\u7b26\u3002"},{name:"chinese",validate:function(a){return!/^[\u4e00-\u9fff]$/.test(a)},defaultMsg:"\u8bf7\u8f93\u5165\u6c49\u5b57\u3002"},{name:"mobile",validate:function(a){return!/^(13|15|18)[0-9]{9}$/.test(a)},defaultMsg:"\u60c5\u8f93\u5165\u6b63\u786e\u624b\u673a\u53f7\u7801\u3002"},{name:"passWord",validate:function(a){return checkPwd($.trim(a))},defaultMsg:"\u5bc6\u7801\u957f\u5ea6\u5fc5\u987b\u57286~16\u4e4b\u95f4\u3002"},{name:"confirmPwd",validate:function(a){return confirmPwd(a)},defaultMsg:"\u4e24\u6b21\u5bc6\u7801\u4e0d\u4e00\u81f4"},{name:"dateYmd",validate:function(a){return checkDate(a)},defaultMsg:"\u8bf7\u8f93\u5165YYYY--MM--DD\u683c\u5f0f"},{name:"idCard",validate:function(a){return checkIdCard(a)},defaultMsg:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u8eab\u4efd\u8bc1\u53f7\u7801"}]},city={11:"\u5317\u4eac",12:"\u5929\u6d25",13:"\u6cb3\u5317",14:"\u5c71\u897f",15:"\u5185\u8499\u53e4",21:"\u8fbd\u5b81",22:"\u5409\u6797",23:"\u9ed1\u9f99\u6c5f",31:"\u4e0a\u6d77",32:"\u6c5f\u82cf",33:"\u6d59\u6c5f",34:"\u5b89\u5fbd",35:"\u798f\u5efa",36:"\u6c5f\u897f",37:"\u5c71\u4e1c",41:"\u6cb3\u5357",42:"\u6e56\u5317",43:"\u6e56\u5357",44:"\u5e7f\u4e1c",45:"\u5e7f\u897f",46:"\u6d77\u5357",50:"\u91cd\u5e86",51:"\u56db\u5ddd",52:"\u8d35\u5dde",53:"\u4e91\u5357",54:"\u897f\u85cf",61:"\u9655\u897f",62:"\u7518\u8083",63:"\u9752\u6d77",64:"\u5b81\u590f",65:"\u65b0\u7586",71:"\u53f0\u6e7e",81:"\u9999\u6e2f",82:"\u6fb3\u95e8",91:"\u56fd\u5916"},checkIdCard=function(a){var d,b=0;if(!/^\d{17}(\d|x)$/i.test(a))return!0;if(a=a.replace(/x$/i,"a"),null==city[parseInt(a.substr(0,2))])return!0;d=a.substr(6,4)+"-"+Number(a.substr(10,2))+"-"+Number(a.substr(12,2));var e=new Date(d.replace(/-/g,"/"));if(d!=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate())return!0;for(var f=17;f>=0;f--)b+=Math.pow(2,f)%11*parseInt(a.charAt(17-f),11);return 1!=b%11?!0:!1},checkDate=function(a){var b=a.match(/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2})$/);if(null==b)return!0;var c=new Date(b[1],b[3]-1,b[4]);return!(c.getFullYear()==b[1]&&c.getMonth()+1==b[3]&&c.getDate()==b[4])},confirmPwd=function(){var b=$("input[type='password']"),c=$.trim(b.eq(0).val()),d=$.trim(b.eq(1).val());return d.length>0?c==d?!1:!0:!0},checkPwd=function(a){return a.length>=6?/[a-zA-Z]+/.test(a)&&/[0-9]+/.test(a)&&/\W+\D+/.test(a)?1:/[a-zA-Z]+/.test(a)||/[0-9]+/.test(a)||/\W+\D+/.test(a)?/[a-zA-Z]+/.test(a)&&/[0-9]+/.test(a)?2:/\[a-zA-Z]+/.test(a)&&/\W+\D+/.test(a)?2:/[0-9]+/.test(a)&&/\W+\D+/.test(a)?2:3:void 0:-1},validateBlur=function(a){$(a).find("input,textarea,select").each(function(){var a=$(this),b=void 0==a.attr("check-type")?null:a.attr("check-type").split(" ");null!==b&&b.length>0&&(a.focus(function(){var b=a.parent(),c=b.children(".help-inline");c.hasClass("help-inline")&&c.remove()}),a.blur(function(){validateField(a,b)}))})},validateForm=function(a){var b=!1;return $(a).find("input,textarea,select").each(function(){var a=$(this),c=void 0==a.attr("check-type")?null:a.attr("check-type").split(" ");null!==c&&c.length>0&&(validateField(a,c)||(b=!0))}),b},validateField=function(field,valid){for(var el=$(field),error=!1,errorMsg="",pwdStatus=0,elLength=el.val().length,rules=defaults.validRules,i=0;rules.length>i;i++){var rule=rules[i];if(valid==rule.name){if("passWord"==rule.name){pwdStatus=rule.validate(el.val()),-1==pwdStatus&&(error=!0,errorMsg=void 0==el.attr("required-message")?rule.defaultMsg:el.attr("required-message"));break}if(rule.validate(el.val())){error=!0,errorMsg=void 0==el.attr("required-message")?rule.defaultMsg:el.attr("required-message");break}}}if(!error){var minMax=void 0==el.attr("min-max")?null:el.attr("min-max").split(" "),_callBack=void 0==el.attr("data-callback")?null:el.attr("data-callback").split(" ");if(null!==minMax&&minMax.length>0){var min=el.attr("min-max").split("-")[0],max=el.attr("min-max").split("-")[1];Number(min)>elLength?(error=!0,errorMsg=void 0==el.attr("min-message")?"\u6587\u672c\u957f\u5ea6\u4e0d\u80fd\u5c0f\u4e8e"+min+"\u4e2a\u5b57\u7b26":el.attr("min-message")):void 0!=max&&elLength>=Number(max)&&(error=!0,errorMsg=void 0==el.attr("max-message")?"\u6587\u672c\u957f\u5ea6\u4e0d\u80fd\u5927\u4e8e"+max+"\u4e2a\u5b57\u7b26":el.attr("max-message"))}else if(null!==_callBack&&_callBack.length>0){var _ajaxCallBack=el.attr("data-callback");error=eval(_ajaxCallBack),error&&(errorMsg=void 0==el.attr("call-message")?"\u6821\u9a8c\u65e0\u6cd5\u901a\u8fc7\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165":el.attr("call-message"))}}var curTextDiv=el.parent(),curErrorEl=curTextDiv.children(".help-inline");if(error){if(curErrorEl.hasClass("help-inline")){var overHelp=curErrorEl.text();curTextDiv.data("help-inline",overHelp)}else curTextDiv.append('<span class="help-inline error">'+errorMsg+"</span>");el.removeClass().addClass("error")}else if(pwdStatus>0){var pwdStrong=passWordStatus(pwdStatus),classpic=classStatus(pwdStatus);curErrorEl.hasClass("help-inline")?curTextDiv.data("help-inline",pwdStrong):curTextDiv.append('<span class="help-inline '+classpic+'">'+pwdStrong+"</span>"),el.removeClass().addClass("right")}else curErrorEl.remove(),el.removeClass().addClass("right");return!error},classStatus=function(a){var b="";switch(a){case 1:b="passWord3";break;case 2:b="passWord2";break;case 3:b="passWord1"}return b},passWordStatus=function(a){var b="";switch(a){case 1:b="\u5f3a";break;case 2:b="\u4e2d";break;case 3:b="\u5f31"}return b}})(jQuery);